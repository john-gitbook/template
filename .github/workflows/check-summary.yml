name: Check SUMMARY.md Coverage

on:
  push:
    paths:
      - '**.md'

jobs:
  check-summary:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Check SUMMARY.md coverage
        run: |
          #!/bin/bash
          set -e
          
          echo "üîç Scanning repository for markdown files..."
          
          # Find all .md files except SUMMARY.md and README.md
          all_md_files=$(find . -type f -name "*.md" \
            ! -path "./SUMMARY.md" \
            ! -path "./README.md" \
            ! -path "*/node_modules/*" \
            ! -path "*/.git/*" \
            | sort)
          
          total_files=$(echo "$all_md_files" | wc -l)
          echo "üìÑ Found $total_files markdown file(s) to check"
          echo ""
          
          # Read SUMMARY.md content
          if [ ! -f "SUMMARY.md" ]; then
            echo "‚ùå SUMMARY.md not found in repository!"
            exit 1
          fi
          
          summary_content=$(cat SUMMARY.md)
          
          # Track missing and found files
          missing_files=()
          found_files=()
          
          # Check each .md file
          for file in $all_md_files; do
            # Remove leading ./ from path
            clean_path="${file#./}"
            
            # Check if the file path appears in SUMMARY.md
            if echo "$summary_content" | grep -q "$clean_path"; then
              found_files+=("$clean_path")
            else
              missing_files+=("$clean_path")
            fi
          done
          
          # Report results
          echo "‚úÖ Files found in SUMMARY.md (${#found_files[@]}/$total_files):"
          if [ ${#found_files[@]} -gt 0 ]; then
            printf '  ‚úì %s\n' "${found_files[@]}"
          fi
          
          echo ""
          
          if [ ${#missing_files[@]} -eq 0 ]; then
            echo "üéâ SUCCESS: All $total_files markdown files are referenced in SUMMARY.md"
            exit 0
          else
            echo "‚ùå MISSING from SUMMARY.md (${#missing_files[@]}/$total_files):"
            printf '  ‚úó %s\n' "${missing_files[@]}"
            echo ""
            echo "Please add these files to SUMMARY.md"
            exit 1
          fi